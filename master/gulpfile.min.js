(function(){"use strict";function p(n){n||(n={});return a.obj(function(t,i,r){if(t.isNull())return r(null,t);t.isStream();var u=l(String(t.contents),n);t.contents=new Buffer(u);r(null,t)})}function f(t){n.util.log(n.util.colors.blue(t))}var l=require("css-flip"),a=require("through2"),t=require("gulp"),n=require("gulp-load-plugins")(),h=n.sync(t),v=require("del"),e=!1,s=!1,i={app:"../app/",markup:"html/",styles:"less/",scripts:"js/",rev:"../rev/"},o={base:{source:require("./vendor.base.json"),dest:"../app/js",name:"base.js"},app:{source:require("./vendor.json"),dest:"../vendor"}},r={scripts:[i.scripts+"app.module.js",i.scripts+"modules_core/**/*.module.js",i.scripts+"modules_core/**/*.js",i.scripts+"modules_custom/**/*.module.js",i.scripts+"modules_custom/**/*.js"],templates:{index:i.markup+"index.html",views:[i.markup+"**/*.html","!"+i.markup+"index.html"]},styles:{app:[i.styles+"*.*"],themes:[i.styles+"themes/*"],watch:[i.styles+"**/*","!"+i.styles+"themes/*"]}},u={scripts:i.app+"js",styles:i.app+"css",templates:{index:"../",views:i.app,cache:i.app+"js/templates.js"},rev:i.rev+"*.json"},c={unformatted:["a","sub","sup","b","i","u","pre","code"]},y={mangle:{except:["$super"]}};t.task("scripts:app",function(){return f("Building scripts.."),t.src(r.scripts).pipe(n.plumber()).pipe(n.jsvalidate()).pipe(n.if(s,n.sourcemaps.init())).pipe(n.concat("app.js")).pipe(n.rev()).pipe(n.ngAnnotate()).pipe(n.if(e,n.uglify({preserveComments:"some"}))).pipe(n.if(s,n.sourcemaps.write())).pipe(t.dest(u.scripts)).pipe(n.rev.manifest()).pipe(t.dest(i.rev))});t.task("vendor",h.sync(["vendor:base","vendor:app"]));t.task("vendor:base",function(){return f("Copying base vendor assets.."),t.src(o.base.source).pipe(n.expectFile(o.base.source)).pipe(n.if(e,n.uglify())).pipe(n.concat(o.base.name)).pipe(t.dest(o.base.dest))});t.task("vendor:app",function(){f("Copying vendor assets..");var i=n.filter("**/*.js",{restore:!0}),r=n.filter("**/*.css",{restore:!0});return t.src(o.app.source,{base:"bower_components"}).pipe(n.expectFile(o.app.source)).pipe(i).pipe(n.if(e,n.uglify(y))).pipe(i.restore).pipe(r).pipe(n.if(e,n.minifyCss())).pipe(r.restore).pipe(t.dest(o.app.dest))});t.task("styles:app",function(){return f("Building application styles.."),t.src(r.styles.app).pipe(n.plumber()).pipe(n.if(s,n.sourcemaps.init())).pipe(n.less()).pipe(n.if(e,n.minifyCss())).pipe(n.if(s,n.sourcemaps.write())).pipe(t.dest(u.styles))});t.task("styles:app:rtl",function(){return f("Building application RTL styles.."),t.src(r.styles.app).pipe(n.plumber()).pipe(n.if(s,n.sourcemaps.init())).pipe(n.less()).pipe(p()).pipe(n.if(e,n.minifyCss())).pipe(n.if(s,n.sourcemaps.write())).pipe(n.rename(function(n){return n.basename+="-rtl",n})).pipe(t.dest(u.styles))});t.task("styles:themes",function(){return f("Building application theme styles.."),t.src(r.styles.themes).pipe(n.plumber()).pipe(n.less()).pipe(t.dest(u.styles))});t.task("templates:index",["scripts:app"],function(){return f("Building index.."),t.src([u.rev,r.templates.index]).pipe(n.plumber()).pipe(n.htmlPrettify(c)).pipe(n.revCollector()).pipe(t.dest(u.templates.index))});t.task("templates:views",function(){return f("Building views.."),t.src(r.templates.views).pipe(n.plumber()).pipe(n.if(!e,n.changed(u.templates.views,{extension:".html"}))).pipe(n.htmlPrettify(c)).pipe(t.dest(u.templates.views))});t.task("watch",function(){f("Starting watch and LiveReload..");n.livereload.listen();t.watch(r.scripts,["templates:index"]);t.watch(r.styles.watch,["styles:app","styles:app:rtl"]);t.watch(r.styles.themes,["styles:themes"]);t.watch(r.templates.views,["templates:views"]);t.watch(r.templates.index,["templates:index"]);var i=1500,u=[].concat(r.scripts,r.styles.watch,r.styles.themes,r.templates.views,r.templates.index);t.watch(u).on("change",function(t){setTimeout(function(){n.livereload.changed(t.path)},i)})});t.task("lint",function(){return t.src(r.scripts).pipe(n.jshint()).pipe(n.jshint.reporter("jshint-stylish",{verbose:!0})).pipe(n.jshint.reporter("fail"))});t.task("clean",function(t){var i=[].concat(u.styles,u.scripts,u.templates.index+"index.html",u.templates.views+"views",u.templates.views+"pages",o.app.dest,u.rev);f("Cleaning: "+n.util.colors.blue(i));v(i,{force:!0},t)});t.task("build",h.sync(["prod","vendor","assets"]));t.task("prod",function(){f("Starting production build...");e=!0});t.task("sourcemaps",["usesources","default"]);t.task("usesources",function(){s=!0});t.task("default",h.sync(["vendor","assets","watch"]),function(){f("************");f("* All Done * You can start editing your code, LiveReload will update your browser after any change..");f("************")});t.task("assets",["scripts:app","styles:app","styles:app:rtl","styles:themes","templates:index","templates:views"])})();