var dropFired=!1,textAngular=angular.module("textAngular",["ngSanitize","textAngularSetup","textAngular.factories","textAngular.DOM","textAngular.validators","textAngular.taBind"]);textAngular.config([function(){angular.forEach(taTools,function(e,t){delete taTools[t]})}]),textAngular.directive("textAngular",["$compile","$timeout","taOptions","taSelection","taExecCommand","textAngularManager","$document","$animate","$log","$q","$parse",function(e,t,a,o,n,l,r,s,i,d,u){return{require:"?ngModel",scope:{},restrict:"EA",priority:2,link:function(c,p,m,f){var y,h,g,E,v,b,x,S,T,w,C,A=m.serial?m.serial:Math.floor(1e16*Math.random());c._name=m.name?m.name:"textAngularEditor"+A;var $=function(e,a,o){t(function(){var t=function(){e.off(a,t),o.apply(this,arguments)};e.on(a,t)},100)};if(T=n(m.taDefaultWrap),angular.extend(c,angular.copy(a),{wrapSelection:function(e,t,a){"undo"===e.toLowerCase()?c["$undoTaBindtaTextElement"+A]():"redo"===e.toLowerCase()?c["$redoTaBindtaTextElement"+A]():(T(e,!1,t,c.defaultTagAttributes),a&&c["reApplyOnSelectorHandlerstaTextElement"+A](),c.displayElements.text[0].focus())},showHtml:c.$eval(m.taShowHtml)||!1}),m.taFocussedClass&&(c.classes.focussed=m.taFocussedClass),m.taTextEditorClass&&(c.classes.textEditor=m.taTextEditorClass),m.taHtmlEditorClass&&(c.classes.htmlEditor=m.taHtmlEditorClass),m.taDefaultTagAttributes)try{angular.extend(c.defaultTagAttributes,angular.fromJson(m.taDefaultTagAttributes))}catch(D){i.error(D)}m.taTextEditorSetup&&(c.setup.textEditorSetup=c.$parent.$eval(m.taTextEditorSetup)),m.taHtmlEditorSetup&&(c.setup.htmlEditorSetup=c.$parent.$eval(m.taHtmlEditorSetup)),m.taFileDrop?c.fileDropHandler=c.$parent.$eval(m.taFileDrop):c.fileDropHandler=c.defaultFileDropHandler,x=p[0].innerHTML,p[0].innerHTML="",c.displayElements={forminput:angular.element("<input type='hidden' tabindex='-1' style='display: none;'>"),html:angular.element("<textarea></textarea>"),text:angular.element("<div></div>"),scrollWindow:angular.element("<div class='ta-scroll-window'></div>"),popover:angular.element('<div class="popover fade bottom" style="max-width: none; width: 305px;"></div>'),popoverArrow:angular.element('<div class="arrow"></div>'),popoverContainer:angular.element('<div class="popover-content"></div>'),resize:{overlay:angular.element('<div class="ta-resizer-handle-overlay"></div>'),background:angular.element('<div class="ta-resizer-handle-background"></div>'),anchors:[angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tr"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-bl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-br"></div>')],info:angular.element('<div class="ta-resizer-handle-info"></div>')}},c.displayElements.popover.append(c.displayElements.popoverArrow),c.displayElements.popover.append(c.displayElements.popoverContainer),c.displayElements.scrollWindow.append(c.displayElements.popover),c.displayElements.popover.on("mousedown",function(e,t){return t&&angular.extend(e,t),e.preventDefault(),!1}),c.showPopover=function(e){c.displayElements.popover.css("display","block"),c.reflowPopover(e),s.addClass(c.displayElements.popover,"in"),$(r.find("body"),"click keyup",function(){c.hidePopover()})},c.reflowPopover=function(e){c.displayElements.text[0].offsetHeight-51>e[0].offsetTop?(c.displayElements.popover.css("top",e[0].offsetTop+e[0].offsetHeight+c.displayElements.scrollWindow[0].scrollTop+"px"),c.displayElements.popover.removeClass("top").addClass("bottom")):(c.displayElements.popover.css("top",e[0].offsetTop-54+c.displayElements.scrollWindow[0].scrollTop+"px"),c.displayElements.popover.removeClass("bottom").addClass("top"));var t=c.displayElements.text[0].offsetWidth-c.displayElements.popover[0].offsetWidth,a=e[0].offsetLeft+e[0].offsetWidth/2-c.displayElements.popover[0].offsetWidth/2;c.displayElements.popover.css("left",Math.max(0,Math.min(t,a))+"px"),c.displayElements.popoverArrow.css("margin-left",Math.min(a,Math.max(0,a-t))-11+"px")},c.hidePopover=function(){c.displayElements.popover.css("display",""),c.displayElements.popoverContainer.attr("style",""),c.displayElements.popoverContainer.attr("class","popover-content"),c.displayElements.popover.removeClass("in")},c.displayElements.resize.overlay.append(c.displayElements.resize.background),angular.forEach(c.displayElements.resize.anchors,function(e){c.displayElements.resize.overlay.append(e)}),c.displayElements.resize.overlay.append(c.displayElements.resize.info),c.displayElements.scrollWindow.append(c.displayElements.resize.overlay),c.reflowResizeOverlay=function(e){e=angular.element(e)[0],c.displayElements.resize.overlay.css({display:"block",left:e.offsetLeft-5+"px",top:e.offsetTop-5+"px",width:e.offsetWidth+10+"px",height:e.offsetHeight+10+"px"}),c.displayElements.resize.info.text(e.offsetWidth+" x "+e.offsetHeight)},c.showResizeOverlay=function(e){var t=r.find("body");w=function(a){var o={width:parseInt(e.attr("width")),height:parseInt(e.attr("height")),x:a.clientX,y:a.clientY};(void 0===o.width||isNaN(o.width))&&(o.width=e[0].offsetWidth),(void 0===o.height||isNaN(o.height))&&(o.height=e[0].offsetHeight),c.hidePopover();var n=o.height/o.width,l=function(t){function a(e){return Math.round(Math.max(0,e))}var l={x:Math.max(0,o.width+(t.clientX-o.x)),y:Math.max(0,o.height+(t.clientY-o.y))},r=void 0!==m.taResizeForceAspectRatio,s=m.taResizeMaintainAspectRatio,i=r||s&&!t.shiftKey;if(i){var d=l.y/l.x;l.x=n>d?l.x:l.y/n,l.y=n>d?l.x*n:l.y}var u=angular.element(e);u.css("height",a(l.y)+"px"),u.css("width",a(l.x)+"px"),c.reflowResizeOverlay(e)};t.on("mousemove",l),$(t,"mouseup",function(e){e.preventDefault(),e.stopPropagation(),t.off("mousemove",l),c.$apply(function(){c.hidePopover(),c.updateTaBindtaTextElement()},100)}),a.stopPropagation(),a.preventDefault()},c.displayElements.resize.anchors[3].off("mousedown"),c.displayElements.resize.anchors[3].on("mousedown",w),c.reflowResizeOverlay(e),$(t,"click",function(){c.hideResizeOverlay()})},c.hideResizeOverlay=function(){c.displayElements.resize.anchors[3].off("mousedown",w),c.displayElements.resize.overlay.css("display","")},c.setup.htmlEditorSetup(c.displayElements.html),c.setup.textEditorSetup(c.displayElements.text),c.displayElements.html.attr({id:"taHtmlElement"+A,"ng-show":"showHtml","ta-bind":"ta-bind","ng-model":"html","ng-model-options":p.attr("ng-model-options")}),c.displayElements.text.attr({id:"taTextElement"+A,contentEditable:"true","ta-bind":"ta-bind","ng-model":"html","ng-model-options":p.attr("ng-model-options")}),c.displayElements.scrollWindow.attr({"ng-hide":"showHtml"}),m.taDefaultWrap&&c.displayElements.text.attr("ta-default-wrap",m.taDefaultWrap),m.taUnsafeSanitizer&&(c.displayElements.text.attr("ta-unsafe-sanitizer",m.taUnsafeSanitizer),c.displayElements.html.attr("ta-unsafe-sanitizer",m.taUnsafeSanitizer)),c.displayElements.scrollWindow.append(c.displayElements.text),p.append(c.displayElements.scrollWindow),p.append(c.displayElements.html),c.displayElements.forminput.attr("name",c._name),p.append(c.displayElements.forminput),m.tabindex&&(p.removeAttr("tabindex"),c.displayElements.text.attr("tabindex",m.tabindex),c.displayElements.html.attr("tabindex",m.tabindex)),m.placeholder&&(c.displayElements.text.attr("placeholder",m.placeholder),c.displayElements.html.attr("placeholder",m.placeholder)),m.taDisabled&&(c.displayElements.text.attr("ta-readonly","disabled"),c.displayElements.html.attr("ta-readonly","disabled"),c.disabled=c.$parent.$eval(m.taDisabled),c.$parent.$watch(m.taDisabled,function(e){c.disabled=e,c.disabled?p.addClass(c.classes.disabled):p.removeClass(c.classes.disabled)})),m.taPaste&&(c._pasteHandler=function(e){return u(m.taPaste)(c.$parent,{$html:e})},c.displayElements.text.attr("ta-paste","_pasteHandler($html)")),e(c.displayElements.scrollWindow)(c),e(c.displayElements.html)(c),c.updateTaBindtaTextElement=c["updateTaBindtaTextElement"+A],c.updateTaBindtaHtmlElement=c["updateTaBindtaHtmlElement"+A],p.addClass("ta-root"),c.displayElements.scrollWindow.addClass("ta-text ta-editor "+c.classes.textEditor),c.displayElements.html.addClass("ta-html ta-editor "+c.classes.htmlEditor),c._actionRunning=!1;var H=!1;if(c.startAction=function(){var e=!1,t=!1,a=!1,o=!1;return c._actionRunning=!0,e=r[0].queryCommandState("bold"),t=r[0].queryCommandState("italic"),a=r[0].queryCommandState("underline"),o=r[0].queryCommandState("strikeThrough"),H=rangy.saveSelection(),e&&!r[0].queryCommandState("bold")&&r[0].execCommand("bold",!1,null),t&&!r[0].queryCommandState("italic")&&r[0].execCommand("italic",!1,null),a&&!r[0].queryCommandState("underline")&&r[0].execCommand("underline",!1,null),o&&!r[0].queryCommandState("strikeThrough")&&r[0].execCommand("strikeThrough",!1,null),function(){H&&rangy.restoreSelection(H)}},c.endAction=function(){c._actionRunning=!1,H&&(c.showHtml?c.displayElements.html[0].focus():c.displayElements.text[0].focus(),rangy.removeMarkers(H)),H=!1,c.updateSelectedStyles(),c.showHtml||c["updateTaBindtaTextElement"+A]()},v=function(e){c.focussed=!0,p.addClass(c.classes.focussed),S.focus(),p.triggerHandler("focus"),c.updateSelectedStyles&&!c._bUpdateSelectedStyles&&t(function(){c.updateSelectedStyles()},0)},c.displayElements.html.on("focus",v),c.displayElements.text.on("focus",v),b=function(e){return c._actionRunning||r[0].activeElement===c.displayElements.html[0]||r[0].activeElement===c.displayElements.text[0]||(p.removeClass(c.classes.focussed),S.unfocus(),t(function(){c._bUpdateSelectedStyles=!1,p.triggerHandler("blur"),c.focussed=!1},0)),e.preventDefault(),!1},c.displayElements.html.on("blur",b),c.displayElements.text.on("blur",b),c.displayElements.text.on("paste",function(e){p.triggerHandler("paste",e)}),c.queryFormatBlockState=function(e){return!c.showHtml&&e.toLowerCase()===r[0].queryCommandValue("formatBlock").toLowerCase()},c.queryCommandState=function(e){return c.showHtml?"":r[0].queryCommandState(e)},c.switchView=function(){c.showHtml=!c.showHtml,s.enabled(!1,c.displayElements.html),s.enabled(!1,c.displayElements.text),c.showHtml?t(function(){return s.enabled(!0,c.displayElements.html),s.enabled(!0,c.displayElements.text),c.displayElements.html[0].focus()},100):t(function(){return s.enabled(!0,c.displayElements.html),s.enabled(!0,c.displayElements.text),c.displayElements.text[0].focus()},100)},m.ngModel){var z=!0;f.$render=function(){if(z){z=!1;var e=c.$parent.$eval(m.ngModel);void 0!==e&&null!==e||!x||""===x||f.$setViewValue(x)}c.displayElements.forminput.val(f.$viewValue),c.html=f.$viewValue||""},p.attr("required")&&(f.$validators.required=function(e,t){var a=e||t;return!(!a||""===a.trim())})}else c.displayElements.forminput.val(x),c.html=x;if(c.$watch("html",function(e,t){e!==t&&(m.ngModel&&f.$viewValue!==e&&f.$setViewValue(e),c.displayElements.forminput.val(e))}),m.taTargetToolbars)S=l.registerEditor(c._name,c,m.taTargetToolbars.split(","));else{var _=angular.element('<div text-angular-toolbar name="textAngularToolbar'+A+'">');m.taToolbar&&_.attr("ta-toolbar",m.taToolbar),m.taToolbarClass&&_.attr("ta-toolbar-class",m.taToolbarClass),m.taToolbarGroupClass&&_.attr("ta-toolbar-group-class",m.taToolbarGroupClass),m.taToolbarButtonClass&&_.attr("ta-toolbar-button-class",m.taToolbarButtonClass),m.taToolbarActiveButtonClass&&_.attr("ta-toolbar-active-button-class",m.taToolbarActiveButtonClass),m.taFocussedClass&&_.attr("ta-focussed-class",m.taFocussedClass),p.prepend(_),e(_)(c.$parent),S=l.registerEditor(c._name,c,["textAngularToolbar"+A])}c.$on("$destroy",function(){l.unregisterEditor(c._name),angular.element(window).off("blur")}),c.$on("ta-element-select",function(e,t){S.triggerElementSelect(e,t)&&c["reApplyOnSelectorHandlerstaTextElement"+A]()}),c.$on("ta-drop-event",function(e,a,o,n){c.displayElements.text[0].focus(),n&&n.files&&n.files.length>0?(angular.forEach(n.files,function(e){try{d.when(c.fileDropHandler(e,c.wrapSelection)||c.fileDropHandler!==c.defaultFileDropHandler&&d.when(c.defaultFileDropHandler(e,c.wrapSelection))).then(function(){c["updateTaBindtaTextElement"+A]()})}catch(t){i.error(t)}}),o.preventDefault(),o.stopPropagation()):t(function(){c["updateTaBindtaTextElement"+A]()},0)}),c._bUpdateSelectedStyles=!1,angular.element(window).on("blur",function(){c._bUpdateSelectedStyles=!1,c.focussed=!1}),c.updateSelectedStyles=function(){var e;C&&t.cancel(C),void 0!==(e=o.getSelectionElement())&&e.parentNode!==c.displayElements.text[0]?S.updateSelectedStyles(angular.element(e)):S.updateSelectedStyles(),c._bUpdateSelectedStyles&&(C=t(c.updateSelectedStyles,200))},y=function(){return c.focussed?void(c._bUpdateSelectedStyles||(c._bUpdateSelectedStyles=!0,c.$apply(function(){c.updateSelectedStyles()}))):void(c._bUpdateSelectedStyles=!1)},c.displayElements.html.on("keydown",y),c.displayElements.text.on("keydown",y),h=function(){c._bUpdateSelectedStyles=!1},c.displayElements.html.on("keyup",h),c.displayElements.text.on("keyup",h),g=function(e,t){if(o.getSelection){var a=o.getSelection();o.getSelectionElement()&&"a"===o.getSelectionElement().nodeName.toLowerCase()&&(3===a.start.element.nodeType&&a.start.element.textContent.length===a.end.offset&&o.setSelectionAfterElement(o.getSelectionElement()),3===a.start.element.nodeType&&0===a.start.offset&&o.setSelectionBeforeElement(o.getSelectionElement()))}t&&angular.extend(e,t),c.$apply(function(){if(S.sendKeyCommand(e))return c._bUpdateSelectedStyles||c.updateSelectedStyles(),e.preventDefault(),!1})},c.displayElements.html.on("keypress",g),c.displayElements.text.on("keypress",g),E=function(){c._bUpdateSelectedStyles=!1,t(function(){c.updateSelectedStyles()},0)},c.displayElements.html.on("mouseup",E),c.displayElements.text.on("mouseup",E)}}}]),textAngular.service("textAngularManager",["taToolExecuteAction","taTools","taRegisterTool","$interval","$rootScope","$log",function(e,t,a,o,n,l){var r,s={},i={},d=0,u=function(e){angular.forEach(i,function(t){t.editorFunctions.updateSelectedStyles(e)})},c=50,p=function(){d=Date.now(),r=o(function(){u(),r=void 0},c,1)};n.$on("destroy",function(){r&&(o.cancel(r),r=void 0)});var m=function(){Math.abs(Date.now()-d)>c&&p()};return{registerEditor:function(a,o,n){if(!a||""===a)throw"textAngular Error: An editor requires a name";if(!o)throw"textAngular Error: An editor requires a scope";if(i[a])throw'textAngular Error: An Editor with name "'+a+'" already exists';return i[a]={scope:o,toolbars:n,toolbarScopes:[],_registerToolbarScope:function(e){this.toolbars.indexOf(e.name)>=0&&this.toolbarScopes.push(e)},editorFunctions:{disable:function(){angular.forEach(i[a].toolbarScopes,function(e){e.disabled=!0})},enable:function(){angular.forEach(i[a].toolbarScopes,function(e){e.disabled=!1})},focus:function(){angular.forEach(i[a].toolbarScopes,function(e){e._parent=o,e.disabled=!1,e.focussed=!0}),o.focussed=!0},unfocus:function(){angular.forEach(i[a].toolbarScopes,function(e){e.disabled=!0,e.focussed=!1}),o.focussed=!1},updateSelectedStyles:function(e){angular.forEach(i[a].toolbarScopes,function(t){angular.forEach(t.tools,function(a){a.activeState&&(t._parent=o,a.active=a.activeState(e))})})},sendKeyCommand:function(n){var l=!1;return(n.ctrlKey||n.metaKey||n.specialKey)&&angular.forEach(t,function(t,r){if(t.commandKeyCode&&(t.commandKeyCode===n.which||t.commandKeyCode===n.specialKey))for(var s=0;s<i[a].toolbarScopes.length;s++)if(void 0!==i[a].toolbarScopes[s].tools[r]){e.call(i[a].toolbarScopes[s].tools[r],o),l=!0;break}}),l},triggerElementSelect:function(e,n){var l=function(e,t){for(var a=!0,o=0;o<t.length;o++)a=a&&e.attr(t[o]);return a},r=[],s={},d=!1;n=angular.element(n);var u=!1;if(angular.forEach(t,function(e,t){e.onElementSelect&&e.onElementSelect.element&&e.onElementSelect.element.toLowerCase()===n[0].tagName.toLowerCase()&&(!e.onElementSelect.filter||e.onElementSelect.filter(n))&&(u=u||angular.isArray(e.onElementSelect.onlyWithAttrs)&&l(n,e.onElementSelect.onlyWithAttrs),e.onElementSelect.onlyWithAttrs&&!l(n,e.onElementSelect.onlyWithAttrs)||(s[t]=e))}),u?(angular.forEach(s,function(e,t){e.onElementSelect.onlyWithAttrs&&l(n,e.onElementSelect.onlyWithAttrs)&&r.push({name:t,tool:e})}),r.sort(function(e,t){return t.tool.onElementSelect.onlyWithAttrs.length-e.tool.onElementSelect.onlyWithAttrs.length})):angular.forEach(s,function(e,t){r.push({name:t,tool:e})}),r.length>0)for(var c=0;c<r.length;c++){for(var p=r[c].tool,m=r[c].name,f=0;f<i[a].toolbarScopes.length;f++)if(void 0!==i[a].toolbarScopes[f].tools[m]){p.onElementSelect.action.call(i[a].toolbarScopes[f].tools[m],e,n,o),d=!0;break}if(d)break}return d}}},angular.forEach(n,function(e){s[e]&&i[a].toolbarScopes.push(s[e])}),m(),i[a].editorFunctions},retrieveEditor:function(e){return i[e]},unregisterEditor:function(e){delete i[e],m()},registerToolbar:function(e){if(!e)throw"textAngular Error: A toolbar requires a scope";if(!e.name||""===e.name)throw"textAngular Error: A toolbar requires a name";if(s[e.name])throw'textAngular Error: A toolbar with name "'+e.name+'" already exists';s[e.name]=e,angular.forEach(i,function(t){t._registerToolbarScope(e)}),m()},retrieveToolbar:function(e){return s[e]},retrieveToolbarsViaEditor:function(e){var t=[],a=this;return angular.forEach(this.retrieveEditor(e).toolbars,function(e){t.push(a.retrieveToolbar(e))}),t},unregisterToolbar:function(e){delete s[e],m()},updateToolsDisplay:function(e){var t=this;angular.forEach(e,function(e,a){t.updateToolDisplay(a,e)})},resetToolsDisplay:function(){var e=this;angular.forEach(t,function(t,a){e.resetToolDisplay(a)}),m()},updateToolDisplay:function(e,t){var a=this;angular.forEach(s,function(o,n){a.updateToolbarToolDisplay(n,e,t)}),m()},resetToolDisplay:function(e){var t=this;angular.forEach(s,function(a,o){t.resetToolbarToolDisplay(o,e)}),m()},updateToolbarToolDisplay:function(e,t,a){if(!s[e])throw'textAngular Error: No Toolbar with name "'+e+'" exists';s[e].updateToolDisplay(t,a)},resetToolbarToolDisplay:function(e,a){if(!s[e])throw'textAngular Error: No Toolbar with name "'+e+'" exists';s[e].updateToolDisplay(a,t[a],!0)},removeTool:function(e){delete t[e],angular.forEach(s,function(t){delete t.tools[e];for(var a=0;a<t.toolbar.length;a++){for(var o,n=0;n<t.toolbar[a].length;n++){if(t.toolbar[a][n]===e){o={group:a,index:n};break}if(void 0!==o)break}void 0!==o&&(t.toolbar[o.group].slice(o.index,1),t._$element.children().eq(o.group).children().eq(o.index).remove())}}),m()},addTool:function(e,t,o,n){a(e,t),angular.forEach(s,function(a){a.addTool(e,t,o,n)}),m()},addToolToToolbar:function(e,t,o,n,l){a(e,t),s[o].addTool(e,t,n,l),m()},refreshEditor:function(e){if(!i[e])throw'textAngular Error: No Editor with name "'+e+'" exists';i[e].scope.updateTaBindtaTextElement(),i[e].scope.$$phase||i[e].scope.$digest(),m()},sendKeyCommand:function(e,t){var a=i[e._name];if(a&&a.editorFunctions.sendKeyCommand(t))return e._bUpdateSelectedStyles||e.updateSelectedStyles(),t.preventDefault(),!1},updateStyles:u,getVersion:function(){return textAngularVersion},getToolbarScopes:function(){var e=[];return angular.forEach(i,function(t){e=e.concat(t.toolbarScopes)}),e}}}]),textAngular.directive("textAngularToolbar",["$compile","textAngularManager","taOptions","taTools","taToolExecuteAction","$window",function(e,t,a,o,n,l){return{scope:{name:"@"},restrict:"EA",link:function(r,s,i){if(!r.name||""===r.name)throw"textAngular Error: A toolbar requires a name";angular.extend(r,angular.copy(a)),i.taToolbar&&(r.toolbar=r.$parent.$eval(i.taToolbar)),i.taToolbarClass&&(r.classes.toolbar=i.taToolbarClass),i.taToolbarGroupClass&&(r.classes.toolbarGroup=i.taToolbarGroupClass),i.taToolbarButtonClass&&(r.classes.toolbarButton=i.taToolbarButtonClass),i.taToolbarActiveButtonClass&&(r.classes.toolbarButtonActive=i.taToolbarActiveButtonClass),i.taFocussedClass&&(r.classes.focussed=i.taFocussedClass),r.disabled=!0,r.focussed=!1,r._$element=s,s[0].innerHTML="",s.addClass("ta-toolbar "+r.classes.toolbar),r.$watch("focussed",function(){r.focussed?s.addClass(r.classes.focussed):s.removeClass(r.classes.focussed)});var d=function(t,a){var o;if(o=t&&t.display?angular.element(t.display):angular.element("<button type='button'>"),t&&t["class"]?o.addClass(t["class"]):o.addClass(r.classes.toolbarButton),o.attr("name",a.name),o.attr("ta-button","ta-button"),o.attr("ng-disabled","isDisabled()"),o.attr("tabindex","-1"),o.attr("ng-click","executeAction()"),o.attr("ng-class","displayActiveToolClass(active)"),t&&t.tooltiptext&&o.attr("title",t.tooltiptext),t&&!t.display&&!a._display&&(o[0].innerHTML="",t.buttontext&&(o[0].innerHTML=t.buttontext),t.iconclass)){var n=angular.element("<i>"),l=o[0].innerHTML;n.addClass(t.iconclass),o[0].innerHTML="",o.append(n),l&&""!==l&&o.append("&nbsp;"+l)}return a._lastToolDefinition=angular.copy(t),e(o)(a)};r.tools={},r._parent={disabled:!0,showHtml:!1,queryFormatBlockState:function(){return!1},queryCommandState:function(){return!1}};var u={$window:l,$editor:function(){return r._parent},isDisabled:function(){return("html"!==this.name||!r._parent.startAction)&&("function"!=typeof this.$eval("disabled")&&this.$eval("disabled")||this.$eval("disabled()")||"html"!==this.name&&this.$editor().showHtml||this.$parent.disabled||this.$editor().disabled)},displayActiveToolClass:function(e){return e?r.classes.toolbarButtonActive:""},executeAction:n};angular.forEach(r.toolbar,function(e){var t=angular.element("<div>");t.addClass(r.classes.toolbarGroup),angular.forEach(e,function(e){r.tools[e]=angular.extend(r.$new(!0),o[e],u,{name:e}),r.tools[e].$element=d(o[e],r.tools[e]),t.append(r.tools[e].$element)}),s.append(t)}),r.updateToolDisplay=function(e,t,a){var o=r.tools[e];if(o){if(o._lastToolDefinition&&!a&&(t=angular.extend({},o._lastToolDefinition,t)),null===t.buttontext&&null===t.iconclass&&null===t.display)throw'textAngular Error: Tool Definition for updating "'+e+'" does not have a valid display/iconclass/buttontext value';null===t.buttontext&&delete t.buttontext,null===t.iconclass&&delete t.iconclass,null===t.display&&delete t.display;var n=d(t,o);o.$element.replaceWith(n),o.$element=n}},r.addTool=function(e,t,a,n){r.tools[e]=angular.extend(r.$new(!0),o[e],u,{name:e}),r.tools[e].$element=d(o[e],r.tools[e]);var l;void 0===a&&(a=r.toolbar.length-1),l=angular.element(s.children()[a]),void 0===n?(l.append(r.tools[e].$element),r.toolbar[a][r.toolbar[a].length-1]=e):(l.children().eq(n).after(r.tools[e].$element),r.toolbar[a][n]=e)},t.registerToolbar(r),r.$on("$destroy",function(){t.unregisterToolbar(r.name)})}}}]),textAngular.directive("textAngularVersion",["textAngularManager",function(e){var t=e.getVersion();return{restrict:"EA",link:function(e,a,o){a.html(t)}}}]);